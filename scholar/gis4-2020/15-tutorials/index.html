<!DOCTYPE html>
<html><head>
  <title>
      
           - henyxia&#39;s website
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Jean Wasilewski" />
  <link rel="shortcut icon" type="image/x-icon" href="https://henyxia.github.io/img/favicon.ico">

  
  
  <link rel="stylesheet" href="https://henyxia.github.io/css/style-pulse.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  <meta property="og:title" content="" />
<meta property="og:description" content="Tutorials Team organization  Everyone will have an assigned team Every team will have an unique ID  Tutorials organization  There will be multiple tutorials Every completed tutorial will be rewarded with points The point quantity will be linked to the difficulty of the tutorial Tutorial completion can only be validated by teachers  Tutorial 1 1 point  Go to your team virtual machine and setup network The proxmox interface is available at https://jw." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://henyxia.github.io/scholar/gis4-2020/15-tutorials/" />

<meta itemprop="name" content="">
<meta itemprop="description" content="Tutorials Team organization  Everyone will have an assigned team Every team will have an unique ID  Tutorials organization  There will be multiple tutorials Every completed tutorial will be rewarded with points The point quantity will be linked to the difficulty of the tutorial Tutorial completion can only be validated by teachers  Tutorial 1 1 point  Go to your team virtual machine and setup network The proxmox interface is available at https://jw.">



<meta itemprop="wordCount" content="765">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Tutorials Team organization  Everyone will have an assigned team Every team will have an unique ID  Tutorials organization  There will be multiple tutorials Every completed tutorial will be rewarded with points The point quantity will be linked to the difficulty of the tutorial Tutorial completion can only be validated by teachers  Tutorial 1 1 point  Go to your team virtual machine and setup network The proxmox interface is available at https://jw."/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146517157-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</head>
<body><nav class="navbar is-transparent is-fixed-top is-info">
  <div class="navbar-brand">
  <a class="navbar-item" href="https://henyxia.github.io/scholar">
      SCHOLAR>
    </a>
    <div class="navbar-burger burger" data-target="navbarExampleTransparentExample">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <div id="navbarExampleTransparentExample" class="navbar-menu">
    <div class="navbar-start">
      <div class="navbar-item" href="https://bulma.io/">
        
      </div>
    </div>
  </div>
</nav>


<br />
<br />
<br />
<br />

<div class="tile is-ancestor">
  <div class="tile is-vertical is-2">
    <div class="tile">
      <div class="tile is-parent">
        <article class="tile is-child">

<ul class="menu-list">
  
  
    
  
  
    
      <li class="">
        
        <p class="menu-label">Projects</p>
        
        <ul class="sub-menu">
          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/projects/soon/">Soon...</a>
        
      </li>
    
  

          
        </ul>
      </li>
    
  

  
    
  
  
    
      <li class="">
        
        <p class="menu-label">Notes</p>
        
        <ul class="sub-menu">
          
            
  
  
    
      <li class="">
        
        <p class="menu-label">Ceph</p>
        
        <ul class="sub-menu">
          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/notes/ceph/create-osd/">Creation</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/notes/ceph/remove-osd/">Deletion</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/notes/ceph/tuning-osd/">Tuning</a>
        
      </li>
    
  

          
        </ul>
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <p class="menu-label">IPMI</p>
        
        <ul class="sub-menu">
          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/notes/ipmi/basics/">Basics</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/notes/ipmi/kernel-module/">kernel modules</a>
        
      </li>
    
  

          
        </ul>
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/notes/sentry/">Sentry</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/notes/raid/">Soft RAID</a>
        
      </li>
    
  

          
        </ul>
      </li>
    
  

  
    
  
  
    
      <li class="active">
        
        <p class="menu-label">Scholar</p>
        
        <ul class="sub-menu">
          
            
  
  
    
      <li class="active">
        
        <p class="menu-label">GIS4 - 2020</p>
        
        <ul class="sub-menu">
          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/00-intro/">Module Presentation</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/01-what-is-a-computer/">A computer in details</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/02-how-works-a-computer/">How works a computer</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/03-what-is-virtualization/">Virtualization types</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/04-what-are-containers/">Container details</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/05-why-moving-to-containers/">Containers benefits</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/06-reminders/">Some reminders</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/07-network/">Major network commands</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/08-docker/">Docker reference</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/09-haproxy/">HAProxy reference</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/10-consul/">Consul reference</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/11-dns/">DNS</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/12-nomad/">Nomad reference</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/13-nginx/">Nginx</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/14-proxmox/">Proxmox reference</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="active">
        
        <a href="https://henyxia.github.io/scholar/gis4-2020/15-tutorials/">2020 - Tutorials</a>
        
      </li>
    
  

          
        </ul>
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <p class="menu-label">GIS4 - 2019</p>
        
        <ul class="sub-menu">
          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/00-intro/">Presentation</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/01-reminders/">Reminders</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/02-network/">Network commands</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/03-vlan/">VLAN definition</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/04-cisco/">Cisco presentation</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/05-system-administration/">Sys admin</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/06-docker/">Docker</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/07-haproxy/">HAProxy</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/08-nomad/">Nomad</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/09-consul/">Consul</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/10-proxmox/">Proxmox</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/11-ansible/">Ansible</a>
        
      </li>
    
  

          
            
  
  
    
      <li class="">
        
        <a href="https://henyxia.github.io/scholar/gis4-2019/12-tutorials/">Tutorials</a>
        
      </li>
    
  

          
        </ul>
      </li>
    
  

          
        </ul>
      </li>
    
  

  
</ul>

</aside>

        </article>
      </div>
    </div>
  </div>
  <div class="tile is-parent">
    <article class="tile is-child notification">
      <div class="content">
        <div class="content">
          
	  

<h2 id="tutorials">Tutorials</h2>

<h3 id="team-organization">Team organization</h3>

<ul>
<li>Everyone will have an assigned team</li>
<li>Every team will have an unique ID</li>
</ul>

<h3 id="tutorials-organization">Tutorials organization</h3>

<ul>
<li>There will be multiple tutorials</li>
<li>Every completed tutorial will be rewarded with points</li>
<li>The point quantity will be linked to the difficulty of the tutorial</li>
<li>Tutorial completion can only be validated by teachers</li>
</ul>

<h1 id="tutorial-1">Tutorial 1</h1>

<h3 id="1-point">1 point</h3>

<ul>
<li>Go to your team virtual machine and setup network</li>
<li>The proxmox interface is available at <a href="https://jw.plil.fr:8006">https://jw.plil.fr:8006</a> (user: <code>root</code>, password: as usual, method: <code>PAM</code>)</li>
<li>Your virtual machine ID is your group number with your group number (ex, group 2 team4: ID=204)</li>
<li>The IP to set is 10.0.1.$VM_ID</li>
<li>The netmask is 255.0.0.0</li>

<li><p>The gateway is 10.0.0.1</p></li>

<li><p>You can test if you successfully set your network configuration by trying to ping Google (8.8.8.8)</p></li>

<li><p>Also, you configuration needs to be reboot-proof</p></li>
</ul>

<h1 id="tutorial-2">Tutorial 2</h1>

<h3 id="1-point-1">1 point</h3>

<ul>
<li><p>Install Nginx and configure it to serve an HTML you will create in /var/www/</p></li>

<li><p>Note: to install nginx, do not forget to set your <code>resolv.conf</code> file</p></li>
</ul>

<h1 id="tutorial-3">Tutorial 3</h1>

<h3 id="1-point-2">1 point</h3>

<ul>
<li>Install HAProxy 2.2</li>

<li><p>Set up HAProxy to accept traffic from port 8888 and redirect it to your Nginx</p></li>

<li><p>Tip: Your virtual machines are running Debian 10</p></li>

<li><p>Second tip: This <a href="https://haproxy.debian.net">website</a> could be useful</p></li>
</ul>

<h1 id="tutorial-4">Tutorial 4</h1>

<h3 id="1-point-3">1 point</h3>

<ul>
<li>Install Docker</li>
<li>Pull the latest Nginx image from Docker Hub</li>
<li>Copy your previous web page inside a Nginx container with <code>docker cp</code> command</li>
<li>Redirect the port 8889 with HAProxy to this container</li>
</ul>

<h1 id="tutorial-5">Tutorial 5</h1>

<h3 id="2-points">2 points</h3>

<ul>
<li>Create a Dockerfile with Nginx and your web page</li>
<li>Create an image with this Dockerfile named <code>web-$VM_ID:v1</code></li>
<li>Publish your image on the registry: 10.99.99.97</li>
</ul>

<h1 id="tutorial-6">Tutorial 6</h1>

<h3 id="1-point-4">1 point</h3>

<ul>
<li>Install Nomad</li>
<li>Use it as a single master and client node (<a href="https://www.nomadproject.io/intro/getting-started/running.html">doc</a>)</li>
</ul>

<h1 id="tutorial-7">Tutorial 7</h1>

<h3 id="2-points-1">2 points</h3>

<ul>
<li>Create a job definition and start your container image with Nomad</li>
</ul>

<h1 id="tutorial-8">Tutorial 8</h1>

<h3 id="3-points">3 points</h3>

<ul>
<li>Increase your website to 3 running containers</li>
<li>Configure HAProxy to use Consul service discovery</li>
</ul>

<h1 id="tutorial-9">Tutorial 9</h1>

<h3 id="1-point-5">1 point</h3>

<ul>
<li>Add a route on your computer (the zabeth) to access the virtual machines directly</li>
<li>Network to add is <code>10.0..0.0/8</code></li>
<li>Hop to use is <code>172.26.145.250</code></li>
</ul>

<h1 id="tutorial-10">Tutorial 10</h1>

<h3 id="2-points-2">2 points</h3>

<ul>
<li>Reconfigure your nomad server to use the common consul (<code>10.99.99.96:8500</code>) and the common nomad server (<code>10.99.99.96:4646</code>)</li>
<li>This <a href="https://www.nomadproject.io/docs/configuration/consul#default">example</a> should help you to setup the consul part</li>
<li>Configure <code>bind_addr</code> to you virtual machine IP</li>
<li>You will need to run nomad with the following command: <code>nomad agent -config=/etc/nomad.d</code></li>
<li>Go to the common nomad <code>http://10.99.99.96:4646/ui/clients</code> and check that your VM IP is well set within the <code>nomad-client</code> service</li>
</ul>

<h1 id="tutorial-11">Tutorial 11</h1>

<h3 id="1-point-6">1 point</h3>

<ul>
<li>Create an account on this Gitlab <a href="https://gitlab.gis-virt.fr/">https://gitlab.gis-virt.fr/</a></li>
<li>Create a repo for your team in <code>gis2020/grp$Xteam$Y</code> with <code>$x</code> being your group number and <code>$y</code> your team number (ex <code>grp1team02</code>)</li>
<li>Add your files to the repo: <code>index.html</code> , <code>Dockerfile</code></li>
<li>Add your nomad job definition, name it: <code>project.nomad</code></li>
</ul>

<h1 id="tutorial-12">Tutorial 12</h1>

<p>This tutorial will make all your previous work deployable automatically from Gitlab.
Steps will be detailed to help you.</p>

<h3 id="3-points-1">3 points</h3>

<ul>
<li>Edit your <code>project.nomad</code> file

<ul>
<li>Set the job name to <code>web-$VMID</code> (ex <code>web-103</code>)</li>
<li>Set memory requierement to 128 Mo</li>
<li>Set CPU requirement to 500 MHz

<ul>
<li>Set count to 4</li>
</ul></li>
<li>Set docker image to <code>10.99.99.97:5000/web-$VMID:${CI_COMMIT_SHORT_SHA}</code> (ex: <code>10.99.99.97:5000/web-103:${CI_COMMIT_SHORT_SHA}</code>)</li>
<li>Set the service name to <code>web-$VMID</code> (ex <code>web-103</code>)</li>
<li>Set the service tag and port to <code>web</code></li>
</ul></li>
<li>Commit and push your changes</li>
<li>Add the following file, named <code>.gitlab-ci.yml</code> to your repository: (do not forget to change <code>$VMID</code>)</li>
</ul>

<p>Note: you must see this file in raw format <a href="https://raw.githubusercontent.com/henyxia/henyxia.github.com/source/content/scholar/GIS4-2020/15-tutorials.md">here</a> to have correct indentation.</p>

<pre><code>variables:
  NOMAD_ADDR: http://10.99.99.96:4646
  docker_registry: 10.99.99.97:5000
  docker_image: web-$VMID

stages:
  - build
  - deploy

build:
  stage: build
  image: docker
  tags:
    - docker
  script:
    - tag=${docker_registry}/${docker_image}:${CI_COMMIT_SHORT_SHA}
    - echo &quot;building and pushing tag $tag&quot;
    - docker build -t ${tag} -f Dockerfile .
    - docker push ${tag}

deploy:
  stage: deploy
  image: hendrikmaus/nomad-cli
  tags:
    - docker
  script:
    - apk add gettext
    - envsubst '${CI_COMMIT_SHORT_SHA}' &lt; project.nomad &gt; job.nomad
    - cat job.nomad
    - nomad validate job.nomad
    - nomad plan job.nomad || if [ $? -eq 255 ]; then exit 255; else echo &quot;success&quot;; fi
    - nomad run job.nomad
</code></pre>

<ul>
<li>You can check the deployment on your Gitlab repo (ex: <code>https://gitlab.gis-virt.fr/gis2020/grp3team01/-/jobs</code>)</li>
<li>Once deployed, you will see your job running on the common Nomad: <a href="http://10.99.99.96:4646/ui/jobs">http://10.99.99.96:4646/ui/jobs</a></li>
</ul>

<h1 id="tutorial-13">Tutorial 13</h1>

<h3 id="1-point-7">1 point</h3>

<ul>
<li>Connect to <code>10.99.99.96</code></li>
<li>Edit the HAProxy configuration

<ul>
<li>Add your backend named <code>web-$VMID</code></li>
<li>Add a redirection from <code>web-$VMID.gis-virt.fr</code> to your backend</li>
<li>Do not forget to validate your configuration with <code>haproxy -c -f /etc/haproxy.cfg</code></li>
<li>Restart with <code>systemctl restart haproxy</code></li>
</ul></li>
<li>You should now see your website by going on <code>https://web-$VMID.gis-virt.fr</code></li>
</ul>

<h1 id="tutorial-14">Tutorial 14</h1>

<h3 id="1-point-8">1 point</h3>

<ul>
<li>Now edit your <code>index.html</code> file</li>
<li>Commit and push your changes</li>
<li>You should see the change on your website <code>https://web-$VMID.gis-virt.fr</code> few seconds/minutes later</li>
</ul>

<h1 id="thank-you-for-following-these-tutorials">Thank you for following these tutorials :)</h1>

        </div>
      </div>
    </article>
  </div>
</div>

  </body>
</html>
